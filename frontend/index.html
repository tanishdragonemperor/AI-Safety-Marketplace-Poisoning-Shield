<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace Poisoning Shield - AI Security Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #030712; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glow { box-shadow: 0 0 30px rgba(6, 182, 212, 0.3); }
        .glow-red { box-shadow: 0 0 30px rgba(239, 68, 68, 0.3); }
        @keyframes pulse-glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .diff-highlight { background: linear-gradient(90deg, rgba(239,68,68,0.2), transparent); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = 'http://localhost:5000/api';

        // Attack type information
        const ATTACK_INFO = {
            hidden_characters: {
                name: 'Hidden Characters',
                icon: 'üëª',
                color: '#ef4444',
                whatChanges: 'Invisible bytes added to title',
                howToSpot: 'Compare byte counts - poisoned has MORE bytes'
            },
            keyword_stuffing: {
                name: 'Keyword Stuffing',
                icon: 'üìù',
                color: '#f59e0b',
                whatChanges: 'SEO spam keywords added to description',
                howToSpot: 'Look for spam words like BEST, TOP RATED, PREMIUM'
            },
            homoglyph: {
                name: 'Homoglyph Attack',
                icon: 'üî§',
                color: '#8b5cf6',
                whatChanges: 'Characters swapped with lookalikes',
                howToSpot: 'Text looks same but byte count differs'
            },
            fake_reviews: {
                name: 'Fake Reviews',
                icon: '‚≠ê',
                color: '#ec4899',
                whatChanges: 'Rating boosted, fake reviews added',
                howToSpot: 'Compare rating and review count'
            },
            adversarial_paraphrase: {
                name: 'Adversarial Paraphrase',
                icon: 'üé≠',
                color: '#10b981',
                whatChanges: 'Misleading claims injected',
                howToSpot: 'Look for brand mentions and authenticity claims'
            },
            metadata_poisoning: {
                name: 'Metadata Poisoning',
                icon: 'üóÑÔ∏è',
                color: '#06b6d4',
                whatChanges: 'Hidden fields and fake metrics added',
                howToSpot: 'Check metadata for suspicious fields'
            }
        };

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(true);
            const [connected, setConnected] = useState(false);
            const [error, setError] = useState(null);

            // Red Team State
            const [selectedAttack, setSelectedAttack] = useState('hidden_characters');
            const [attackResult, setAttackResult] = useState(null);
            const [attackLoading, setAttackLoading] = useState(false);

            // Search State
            const [searchQuery, setSearchQuery] = useState('premium');
            const [searchResults, setSearchResults] = useState(null);
            const [searchLoading, setSearchLoading] = useState(false);

            // Products State
            const [products, setProducts] = useState([]);

            useEffect(() => {
                checkConnection();
            }, []);

            const checkConnection = async () => {
                try {
                    const response = await fetch(`${API_BASE}/status`);
                    if (response.ok) {
                        setConnected(true);
                        loadAllData();
                    }
                } catch (err) {
                    setError('Cannot connect to API');
                    setLoading(false);
                }
            };

            const loadAllData = async () => {
                try {
                    const [statsRes, productsRes] = await Promise.all([
                        fetch(`${API_BASE}/stats`),
                        fetch(`${API_BASE}/products?limit=50`)
                    ]);
                    const statsData = await statsRes.json();
                    const productsData = await productsRes.json();
                    setStats(statsData);
                    setProducts(productsData.products || []);
                    setLoading(false);
                } catch (err) {
                    setError('Failed to load data');
                    setLoading(false);
                }
            };

            const runAttack = async () => {
                setAttackLoading(true);
                setAttackResult(null);
                try {
                    const response = await fetch(`${API_BASE}/attack/demo`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ attack_type: selectedAttack })
                    });
                    const data = await response.json();
                    console.log('Attack result:', data);  // Debug
                    setAttackResult(data);
                } catch (err) {
                    console.error('Attack failed:', err);
                }
                setAttackLoading(false);
            };

            const runSearch = async () => {
                if (!searchQuery.trim()) return;
                setSearchLoading(true);
                try {
                    const response = await fetch(`${API_BASE}/search/compare?q=${encodeURIComponent(searchQuery)}&limit=5`);
                    const data = await response.json();
                    console.log('Search result:', data);  // Debug
                    setSearchResults(data);
                } catch (err) {
                    console.error('Search failed:', err);
                }
                setSearchLoading(false);
            };

            // Connection error screen
            if (!connected && !loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-8">
                        <div className="text-center max-w-lg">
                            <div className="text-6xl mb-6">üîå</div>
                            <h1 className="text-2xl font-bold text-white mb-4">API Not Connected</h1>
                            <p className="text-gray-400 mb-6">Run this command in your terminal:</p>
                            <div className="bg-gray-900 border border-gray-700 rounded-lg p-4 mono text-cyan-400">
                                python run_server.py
                            </div>
                            <button onClick={checkConnection} className="mt-6 px-6 py-3 bg-cyan-600 hover:bg-cyan-500 rounded-lg font-medium">
                                Retry Connection
                            </button>
                        </div>
                    </div>
                );
            }

            // Loading screen
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-4xl animate-spin mb-4">‚öôÔ∏è</div>
                            <p className="text-gray-400">Loading...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen text-gray-100">
                    {/* Header */}
                    <header className="border-b border-gray-800 bg-gray-900/80 backdrop-blur-xl sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-2xl glow">
                                        üõ°Ô∏è
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-bold">
                                            <span className="text-cyan-400">MARKETPLACE</span>
                                            <span className="text-gray-400"> POISONING </span>
                                            <span className="text-red-400">SHIELD</span>
                                        </h1>
                                        <p className="text-xs text-gray-500 mono">AI SECURITY DEFENSE SYSTEM</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center gap-2 px-4 py-2 bg-green-900/30 border border-green-700 rounded-lg">
                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
                                        <span className="text-xs text-green-400 mono">API CONNECTED</span>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-xs text-gray-500">Project by</p>
                                        <p className="text-sm font-medium">Tanish Gupta</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="border-b border-gray-800 bg-gray-900/30">
                        <div className="max-w-7xl mx-auto px-6 flex">
                            {['dashboard', 'redteam', 'blueteam', 'search', 'products'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-6 py-3 font-medium transition-all border-b-2 ${
                                        activeTab === tab 
                                            ? 'border-cyan-400 text-cyan-400 bg-cyan-400/5' 
                                            : 'border-transparent text-gray-400 hover:text-gray-200'
                                    }`}
                                >
                                    {tab === 'dashboard' && 'üìä Dashboard'}
                                    {tab === 'redteam' && '‚öîÔ∏è Red Team'}
                                    {tab === 'blueteam' && 'üõ°Ô∏è Blue Team'}
                                    {tab === 'search' && 'üîç Search Demo'}
                                    {tab === 'products' && 'üì¶ Products'}
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-6 py-8">
                        
                        {/* ============ DASHBOARD TAB ============ */}
                        {activeTab === 'dashboard' && stats && (
                            <div className="space-y-8">
                                {/* Stats Grid */}
                                <div className="grid grid-cols-4 gap-6">
                                    <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                                        <p className="text-gray-500 text-sm mb-1">Total Products</p>
                                        <p className="text-4xl font-bold text-cyan-400">{stats.dataset?.total_products || 0}</p>
                                    </div>
                                    <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                                        <p className="text-gray-500 text-sm mb-1">Poisoned</p>
                                        <p className="text-4xl font-bold text-red-400">{stats.dataset?.poisoned_products || 0}</p>
                                    </div>
                                    <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                                        <p className="text-gray-500 text-sm mb-1">Detected</p>
                                        <p className="text-4xl font-bold text-green-400">{stats.defense?.true_positives || 0}</p>
                                    </div>
                                    <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                                        <p className="text-gray-500 text-sm mb-1">F1 Score</p>
                                        <p className="text-4xl font-bold text-purple-400">{((stats.defense?.f1_score || 0) * 100).toFixed(0)}%</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-6">
                                    {/* Attack Distribution */}
                                    <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                                        <h3 className="text-lg font-semibold mb-4 text-red-400">‚öîÔ∏è Attack Distribution</h3>
                                        <div className="space-y-3">
                                            {stats.attacks && Object.entries(stats.attacks).map(([attack, count]) => {
                                                const info = ATTACK_INFO[attack] || { name: attack, color: '#888', icon: '‚ùì' };
                                                const maxCount = Math.max(...Object.values(stats.attacks), 1);
                                                return (
                                                    <div key={attack}>
                                                        <div className="flex justify-between text-sm mb-1">
                                                            <span className="text-gray-400">{info.icon} {info.name}</span>
                                                            <span className="mono text-gray-500">{count}</span>
                                                        </div>
                                                        <div className="h-2 bg-gray-800 rounded-full overflow-hidden">
                                                            <div className="h-full rounded-full" style={{ width: `${(count / maxCount) * 100}%`, backgroundColor: info.color }} />
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    {/* Defense Metrics */}
                                    <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                                        <h3 className="text-lg font-semibold mb-4 text-cyan-400">üõ°Ô∏è Defense Metrics</h3>
                                        <div className="space-y-4">
                                            {[
                                                { label: 'Precision', value: stats.defense?.precision || 0 },
                                                { label: 'Recall', value: stats.defense?.recall || 0 },
                                                { label: 'F1 Score', value: stats.defense?.f1_score || 0 }
                                            ].map(m => (
                                                <div key={m.label}>
                                                    <div className="flex justify-between text-sm mb-1">
                                                        <span className="text-gray-400">{m.label}</span>
                                                        <span className="text-cyan-400 mono">{(m.value * 100).toFixed(1)}%</span>
                                                    </div>
                                                    <div className="h-3 bg-gray-800 rounded-full overflow-hidden">
                                                        <div className="h-full bg-gradient-to-r from-cyan-600 to-cyan-400 rounded-full" style={{ width: `${m.value * 100}%` }} />
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="mt-6 pt-4 border-t border-gray-800 grid grid-cols-2 gap-3 text-center">
                                            <div className="bg-green-900/20 border border-green-800 rounded-lg p-3">
                                                <div className="text-2xl font-bold text-green-400">{stats.defense?.true_positives || 0}</div>
                                                <div className="text-xs text-green-600">True Positives</div>
                                            </div>
                                            <div className="bg-red-900/20 border border-red-800 rounded-lg p-3">
                                                <div className="text-2xl font-bold text-red-400">{stats.defense?.false_positives || 0}</div>
                                                <div className="text-xs text-red-600">False Positives</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ============ RED TEAM TAB ============ */}
                        {activeTab === 'redteam' && (
                            <div className="space-y-6">
                                {/* Header */}
                                <div className="bg-gradient-to-r from-red-950/50 to-gray-900 border border-red-900/50 rounded-xl p-6 glow-red">
                                    <h2 className="text-2xl font-bold text-red-400 flex items-center gap-3">
                                        ‚öîÔ∏è Red Team - Attack Simulator
                                    </h2>
                                    <p className="text-gray-400 mt-1">Select an attack type and execute to see the poisoning effect</p>
                                </div>

                                {/* Attack Selection */}
                                <div className="grid grid-cols-3 gap-4">
                                    {Object.entries(ATTACK_INFO).map(([key, info]) => (
                                        <button
                                            key={key}
                                            onClick={() => { setSelectedAttack(key); setAttackResult(null); }}
                                            className={`p-5 rounded-xl border text-left transition-all ${
                                                selectedAttack === key 
                                                    ? 'border-red-500 bg-red-950/40 ring-2 ring-red-500/30' 
                                                    : 'border-gray-800 bg-gray-900/30 hover:border-gray-700'
                                            }`}
                                        >
                                            <div className="text-3xl mb-2">{info.icon}</div>
                                            <div className="font-semibold text-gray-200">{info.name}</div>
                                            <div className="text-xs text-gray-500 mt-1">{info.whatChanges}</div>
                                        </button>
                                    ))}
                                </div>

                                {/* Execute Button */}
                                <button
                                    onClick={runAttack}
                                    disabled={attackLoading}
                                    className="w-full py-4 bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-3 disabled:opacity-50"
                                >
                                    {attackLoading ? '‚è≥ Running Attack...' : '‚ö° Execute Attack Simulation'}
                                </button>

                                {/* Attack Results */}
                                {attackResult && (
                                    <div className="space-y-4">
                                        {/* What Changed Banner */}
                                        <div className="bg-yellow-900/20 border border-yellow-700 rounded-xl p-4">
                                            <h4 className="font-semibold text-yellow-400 mb-2">
                                                üîç What to look for in "{ATTACK_INFO[selectedAttack]?.name}":
                                            </h4>
                                            <p className="text-yellow-200/80 text-sm">{ATTACK_INFO[selectedAttack]?.howToSpot}</p>
                                        </div>

                                        {/* Side by Side Comparison */}
                                        <div className="grid grid-cols-2 gap-6">
                                            {/* ORIGINAL */}
                                            <div className="bg-gray-900/50 border border-green-800 rounded-xl p-6">
                                                <h4 className="text-green-400 font-bold text-lg mb-4 flex items-center gap-2">
                                                    ‚úì ORIGINAL (Before Attack)
                                                </h4>
                                                <div className="space-y-4">
                                                    <div>
                                                        <label className="text-xs text-gray-500 uppercase">Title</label>
                                                        <p className="text-gray-200 mono text-sm bg-gray-800/50 p-2 rounded mt-1">{attackResult.original?.title}</p>
                                                        <p className="text-xs text-gray-600 mt-1">Bytes: {attackResult.changes?.title_bytes_original}</p>
                                                    </div>
                                                    <div>
                                                        <label className="text-xs text-gray-500 uppercase">Description</label>
                                                        <p className="text-gray-400 text-sm bg-gray-800/50 p-2 rounded mt-1 max-h-20 overflow-hidden">
                                                            {attackResult.original?.description?.slice(0, 150)}...
                                                        </p>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label className="text-xs text-gray-500 uppercase">Rating</label>
                                                            <p className="text-2xl font-bold text-yellow-400">‚òÖ {attackResult.original?.rating}</p>
                                                        </div>
                                                        <div>
                                                            <label className="text-xs text-gray-500 uppercase">Reviews</label>
                                                            <p className="text-2xl font-bold text-gray-300">{attackResult.original?.review_count}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* POISONED */}
                                            <div className="bg-red-950/30 border border-red-800 rounded-xl p-6">
                                                <h4 className="text-red-400 font-bold text-lg mb-4 flex items-center gap-2">
                                                    ‚úó POISONED (After Attack)
                                                </h4>
                                                <div className="space-y-4">
                                                    <div>
                                                        <label className="text-xs text-gray-500 uppercase">Title</label>
                                                        <p className="text-gray-200 mono text-sm bg-gray-800/50 p-2 rounded mt-1">{attackResult.poisoned?.title}</p>
                                                        <div className="flex items-center gap-2 mt-1">
                                                            <p className="text-xs text-gray-600">Bytes: {attackResult.changes?.title_bytes_poisoned}</p>
                                                            {attackResult.changes?.title_bytes_diff > 0 && (
                                                                <span className="text-xs px-2 py-0.5 bg-red-900 text-red-300 rounded">
                                                                    +{attackResult.changes?.title_bytes_diff} hidden bytes!
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <label className="text-xs text-gray-500 uppercase">Description</label>
                                                        <p className={`text-sm bg-gray-800/50 p-2 rounded mt-1 max-h-20 overflow-hidden ${attackResult.changes?.description_changed ? 'text-red-300' : 'text-gray-400'}`}>
                                                            {attackResult.poisoned?.description?.slice(0, 150)}...
                                                        </p>
                                                        {attackResult.changes?.description_changed && (
                                                            <span className="text-xs text-red-400 mt-1">‚ö†Ô∏è Description modified (+{attackResult.changes?.description_length_diff} chars)</span>
                                                        )}
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label className="text-xs text-gray-500 uppercase">Rating</label>
                                                            <div className="flex items-center gap-2">
                                                                <p className="text-2xl font-bold text-yellow-400">‚òÖ {attackResult.poisoned?.rating}</p>
                                                                {attackResult.changes?.rating_diff > 0 && (
                                                                    <span className="text-sm px-2 py-1 bg-red-900 text-red-300 rounded font-bold">
                                                                        +{attackResult.changes?.rating_diff} üöÄ
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <label className="text-xs text-gray-500 uppercase">Reviews</label>
                                                            <div className="flex items-center gap-2">
                                                                <p className="text-2xl font-bold text-gray-300">{attackResult.poisoned?.review_count}</p>
                                                                {attackResult.changes?.reviews_added > 0 && (
                                                                    <span className="text-xs px-2 py-0.5 bg-red-900 text-red-300 rounded">
                                                                        +{attackResult.changes?.reviews_added} fake
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Defense Detection */}
                                                <div className="mt-4 pt-4 border-t border-red-900/50">
                                                    <div className="flex items-center justify-between">
                                                        <span className="text-gray-400">Defense Detection:</span>
                                                        <span className={`font-bold ${attackResult.defense_result?.detected ? 'text-green-400' : 'text-red-400'}`}>
                                                            {attackResult.defense_result?.detected ? '‚úì CAUGHT!' : '‚úó EVADED'}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center justify-between mt-2">
                                                        <span className="text-gray-400">Threat Score:</span>
                                                        <span className="text-orange-400 mono font-bold">{attackResult.defense_result?.threat_score}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Changes Summary */}
                                        <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-4">
                                            <h4 className="font-semibold text-gray-300 mb-3">üìã Changes Summary</h4>
                                            <div className="grid grid-cols-4 gap-4 text-center">
                                                <div className={`p-3 rounded-lg ${attackResult.changes?.title_bytes_diff > 0 ? 'bg-red-900/30' : 'bg-gray-800/30'}`}>
                                                    <div className="text-xl font-bold text-gray-200">
                                                        {attackResult.changes?.title_bytes_diff > 0 ? `+${attackResult.changes?.title_bytes_diff}` : '0'}
                                                    </div>
                                                    <div className="text-xs text-gray-500">Hidden Bytes</div>
                                                </div>
                                                <div className={`p-3 rounded-lg ${attackResult.changes?.description_changed ? 'bg-red-900/30' : 'bg-gray-800/30'}`}>
                                                    <div className="text-xl font-bold text-gray-200">
                                                        {attackResult.changes?.description_changed ? 'Yes' : 'No'}
                                                    </div>
                                                    <div className="text-xs text-gray-500">Desc Changed</div>
                                                </div>
                                                <div className={`p-3 rounded-lg ${attackResult.changes?.rating_diff > 0 ? 'bg-red-900/30' : 'bg-gray-800/30'}`}>
                                                    <div className="text-xl font-bold text-gray-200">
                                                        {attackResult.changes?.rating_diff > 0 ? `+${attackResult.changes?.rating_diff}` : '0'}
                                                    </div>
                                                    <div className="text-xs text-gray-500">Rating Boost</div>
                                                </div>
                                                <div className={`p-3 rounded-lg ${attackResult.changes?.reviews_added > 0 ? 'bg-red-900/30' : 'bg-gray-800/30'}`}>
                                                    <div className="text-xl font-bold text-gray-200">
                                                        {attackResult.changes?.reviews_added > 0 ? `+${attackResult.changes?.reviews_added}` : '0'}
                                                    </div>
                                                    <div className="text-xs text-gray-500">Fake Reviews</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* ============ BLUE TEAM TAB ============ */}
                        {activeTab === 'blueteam' && (
                            <div className="space-y-6">
                                <div className="bg-gradient-to-r from-cyan-950/50 to-gray-900 border border-cyan-900/50 rounded-xl p-6 glow">
                                    <h2 className="text-2xl font-bold text-cyan-400">üõ°Ô∏è Blue Team - Defense System</h2>
                                    <p className="text-gray-400 mt-1">6-layer defense architecture (Defense in Depth)</p>
                                </div>

                                <div className="grid grid-cols-3 gap-4">
                                    {[
                                        { name: 'Unicode Scanner', desc: 'Detects hidden zero-width characters', icon: 'üëÅÔ∏è' },
                                        { name: 'Keyword Analyzer', desc: 'Identifies SEO spam patterns', icon: 'üîç' },
                                        { name: 'Homoglyph Detector', desc: 'Finds character substitutions', icon: 'üî§' },
                                        { name: 'Review Validator', desc: 'Flags fake review patterns', icon: '‚≠ê' },
                                        { name: 'Metadata Inspector', desc: 'Validates data integrity', icon: 'üìã' },
                                        { name: 'Statistical Analyzer', desc: 'Compares against baseline', icon: 'üìä' }
                                    ].map((layer, i) => (
                                        <div key={i} className="bg-gray-900/50 border border-gray-800 rounded-xl p-5 hover:border-cyan-800 transition-colors">
                                            <div className="flex items-center justify-between mb-3">
                                                <span className="text-2xl">{layer.icon}</span>
                                                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
                                            </div>
                                            <h4 className="font-semibold text-gray-200">{layer.name}</h4>
                                            <p className="text-xs text-gray-500 mt-1">{layer.desc}</p>
                                        </div>
                                    ))}
                                </div>

                                <div className="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                                    <h3 className="font-semibold text-gray-300 mb-4">Defense Pipeline Flow</h3>
                                    <div className="flex items-center justify-between">
                                        {['üì• Input', 'üëÅÔ∏è Unicode', 'üîç Keywords', 'üî§ Homoglyph', '‚≠ê Reviews', 'üìã Metadata', '‚úÖ Output'].map((step, i) => (
                                            <React.Fragment key={i}>
                                                <div className="flex flex-col items-center">
                                                    <div className={`w-14 h-14 rounded-xl flex items-center justify-center text-xl ${
                                                        i === 0 ? 'bg-gray-800' : i === 6 ? 'bg-green-900/50 border border-green-700' : 'bg-cyan-900/30 border border-cyan-800'
                                                    }`}>
                                                        {step.split(' ')[0]}
                                                    </div>
                                                    <span className="text-xs text-gray-500 mt-2">{step.split(' ')[1]}</span>
                                                </div>
                                                {i < 6 && <span className="text-gray-600 text-2xl">‚Üí</span>}
                                            </React.Fragment>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ============ SEARCH DEMO TAB ============ */}
                        {activeTab === 'search' && (
                            <div className="space-y-6">
                                <div className="bg-gradient-to-r from-purple-950/50 to-gray-900 border border-purple-900/50 rounded-xl p-6">
                                    <h2 className="text-2xl font-bold text-purple-400">üîç Search Demo - Real Impact</h2>
                                    <p className="text-gray-400 mt-1">See how defense protects search results from poisoned products</p>
                                </div>

                                {/* Search Box */}
                                <div className="flex gap-4">
                                    <input
                                        type="text"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && runSearch()}
                                        placeholder="Try: premium, best, quality, headphones..."
                                        className="flex-1 px-4 py-4 bg-gray-900 border border-gray-800 rounded-xl text-gray-200 placeholder-gray-600 focus:border-purple-500 focus:outline-none"
                                    />
                                    <button
                                        onClick={runSearch}
                                        disabled={searchLoading}
                                        className="px-8 py-4 bg-purple-600 hover:bg-purple-500 rounded-xl font-semibold transition-colors disabled:opacity-50"
                                    >
                                        {searchLoading ? '‚è≥ Searching...' : 'üîç Search'}
                                    </button>
                                </div>

                                {/* Quick Search Buttons */}
                                <div className="flex gap-2">
                                    <span className="text-gray-500 text-sm">Quick search:</span>
                                    {['premium', 'best quality', 'top rated', 'headphones'].map(q => (
                                        <button
                                            key={q}
                                            onClick={() => { setSearchQuery(q); }}
                                            className="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded text-sm text-gray-400"
                                        >
                                            {q}
                                        </button>
                                    ))}
                                </div>

                                {/* Search Results Comparison */}
                                {searchResults && (
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-6">
                                            {/* Without Defense - No detection badges, users can't tell what's poisoned */}
                                            <div className="bg-gray-900/50 border border-red-900/50 rounded-xl p-6">
                                                <h3 className="text-lg font-semibold mb-4 flex items-center gap-2 text-red-400">
                                                    ‚ùå WITHOUT Defense (Vulnerable)
                                                </h3>
                                                <div className="space-y-2">
                                                    {searchResults.baseline?.results?.map((item, i) => (
                                                        <div 
                                                            key={i}
                                                            className="p-3 rounded-lg border bg-gray-800/30 border-gray-700"
                                                        >
                                                            <div className="flex items-center justify-between">
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-gray-500 mono text-sm">{item.rank}.</span>
                                                                    <span className="text-sm text-gray-200">{item.title?.slice(0, 35)}...</span>
                                                                </div>
                                                                {/* No badge - without defense, users can't detect poisoned items */}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="mt-4 pt-4 border-t border-gray-800 text-center">
                                                    <span className="text-gray-400">Poisoned in top 5: </span>
                                                    <span className="text-2xl font-bold text-red-400">{searchResults.baseline?.poisoned_in_top_5}</span>
                                                </div>
                                            </div>

                                            {/* With Defense - Shows detection badges for suspicious items */}
                                            <div className="bg-gray-900/50 border border-green-900/50 rounded-xl p-6">
                                                <h3 className="text-lg font-semibold mb-4 flex items-center gap-2 text-green-400">
                                                    üõ°Ô∏è WITH Defense (Protected)
                                                </h3>
                                                <div className="space-y-2">
                                                    {searchResults.defended?.results?.map((item, i) => (
                                                        <div 
                                                            key={i}
                                                            className={`p-3 rounded-lg border ${
                                                                item.is_suspicious 
                                                                    ? 'bg-red-950/50 border-red-800' 
                                                                    : 'bg-gray-800/30 border-gray-700'
                                                            }`}
                                                        >
                                                            <div className="flex items-center justify-between">
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-gray-500 mono text-sm">{item.rank}.</span>
                                                                    <span className="text-sm text-gray-200">{item.title?.slice(0, 35)}...</span>
                                                                </div>
                                                                {item.is_suspicious && (
                                                                    <span className="text-xs px-2 py-0.5 bg-red-900 text-red-300 rounded font-bold">
                                                                        ‚ö†Ô∏è SUSPICIOUS
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="mt-4 pt-4 border-t border-gray-800 text-center">
                                                    <span className="text-gray-400">Suspicious detected: </span>
                                                    <span className="text-2xl font-bold text-yellow-400">{searchResults.defended?.results?.filter(r => r.is_suspicious).length || 0}</span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Impact Summary */}
                                        <div className="bg-green-900/20 border border-green-700 rounded-xl p-4 text-center">
                                            <span className="text-xl">‚ú® </span>
                                            <span className="text-green-400 font-bold text-lg">
                                                Defense detected {searchResults.defended?.results?.filter(r => r.is_suspicious).length || 0} suspicious products and demoted them in rankings!
                                            </span>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* ============ PRODUCTS TAB ============ */}
                        {activeTab === 'products' && (
                            <div className="bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden">
                                <table className="w-full">
                                    <thead className="bg-gray-800/50">
                                        <tr className="text-left text-gray-400 text-sm">
                                            <th className="px-4 py-3">Product</th>
                                            <th className="px-4 py-3">Category</th>
                                            <th className="px-4 py-3">Rating</th>
                                            <th className="px-4 py-3">Status</th>
                                            <th className="px-4 py-3">Threat</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-800">
                                        {products.slice(0, 20).map((p, i) => (
                                            <tr key={i} className="hover:bg-gray-800/30">
                                                <td className="px-4 py-3">
                                                    <div className="text-sm text-gray-200">{p.title?.slice(0, 40)}...</div>
                                                </td>
                                                <td className="px-4 py-3">
                                                    <span className="px-2 py-1 bg-gray-800 rounded text-xs text-gray-400">{p.category}</span>
                                                </td>
                                                <td className="px-4 py-3 text-yellow-400">‚òÖ {p.rating}</td>
                                                <td className="px-4 py-3">
                                                    {p.is_poisoned ? (
                                                        <span className="text-red-400 text-sm">‚ò†Ô∏è {ATTACK_INFO[p.poison_type]?.name || p.poison_type}</span>
                                                    ) : (
                                                        <span className="text-green-400 text-sm">‚úì Clean</span>
                                                    )}
                                                </td>
                                                <td className="px-4 py-3">
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-16 h-2 bg-gray-800 rounded-full overflow-hidden">
                                                            <div 
                                                                className={`h-full rounded-full ${
                                                                    (p.defense_result?.threat_score || 0) > 0.5 ? 'bg-red-500' : 
                                                                    (p.defense_result?.threat_score || 0) > 0.3 ? 'bg-yellow-500' : 'bg-green-500'
                                                                }`}
                                                                style={{ width: `${(p.defense_result?.threat_score || 0) * 100}%` }}
                                                            />
                                                        </div>
                                                        <span className="text-xs mono text-gray-500">
                                                            {(p.defense_result?.threat_score || 0).toFixed(2)}
                                                        </span>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="border-t border-gray-800 mt-12 py-6 text-center text-gray-500 text-sm">
                        Marketplace Poisoning Shield ‚Ä¢ AI Security Project ‚Ä¢ Tanish Gupta
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
